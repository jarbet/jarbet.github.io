{
  "hash": "673ec1051db24d0427ae008904ea1342",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Imputing missing data\"\ndescription: \"Introduction to methods for imputing missing values\"\ncategories: [missing-data]\nimage: /posts/pics/missing.jpeg\nexecute:\n  cache: true\ndate: 2025-01-04\nauthor: Jaron Arbet\n---\n\n\n\n\n# Intro\n\n[Missing data analysis: Making it work in the real world](https://www.annualreviews.org/doi/abs/10.1146/annurev.psych.58.110405.085530)\n\n* Multiple imputation is the gold standard method for handling missing data but is computationally intensive.\n* EM algorithm works well, but lack of general software.\n* If doing likelihood-based regression modeling, then as long as you adjust for variables that influence missingness, results will not be biased due to missing data (although patients with missing values are dropped from the model, thus decreasing power).\n    * Imputation likely still better due to improved power (i.e. all patients can be included).\n\n# Single imputation\n\nThere are various scenarios where one wants to impute missing values a single time:\n\n* When the goal is not statistical inference, but prediction \n* If you want to cluster your data before using `BoutrosLab.plotting.general::create.heatmap`\n* If the goal is statistical inference, often people will still do single imputation despite multiple imputation being the gold standard.  Single imputation is so much easier/faster although more biased.\n\n\n**R notes**:\n\n* Set the seed beforehand\n* All of these methods will throw errors if some features have 0 variance (i.e. they only take on 1 value).  Remove such features beforehand.\n*  For `missForest/missMDA`: make sure rownames are set to patient.id beforehand \n*  For `impute::impute.knn`: make sure rownames are feature names and colnames are patient.id\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsuppressPackageStartupMessages(library(missForest));\nsuppressPackageStartupMessages(library(missMDA));\nsuppressPackageStartupMessages(library(impute));\n```\n:::\n\n\n\n\n## Continuous\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123);\n\ndata('geno', package = 'missMDA'); \n\n# impute.knn (features in rows, samples in cols)\n# this is my preferred method for high dimensional continuous data since it is relatively fast\nknn.imp <- impute::impute.knn(t(geno))$data;\nknn.imp <- data.frame(t(knn.imp), check.names = FALSE);\n\n# PCA (samples in rows, features in cols)\nncomp <- missMDA::estim_ncpPCA(geno, ncp.min = 0, ncp.max = 6);\npca.imp <- missMDA::imputePCA(geno, ncp = ncomp$ncp, scale = TRUE)$completeObs;\n\n# missForest\nmf.imp <- missForest::missForest(geno)$ximp;\n```\n:::\n\n\n\n\n## Categorical\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata('vnf', package = 'missMDA');\n\n# missForest\nmf.imp <- missForest::missForest(vnf)$ximp;\n\n# MCA\n#ncomp <- missMDA::estim_ncpMCA(vnf); # slow method to estimate number of components\nmca.imp <- missMDA::imputeMCA(vnf, ncp = 3)$complete.obs;\n```\n:::\n\n\n\n\n## Mixed continuous/categorical\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata('snorena', package = 'missMDA'); \n\n# missForest\nmf.imp <- missForest::missForest(snorena)$ximp;\n\n# FAMD\n#missMDA::estim_ncpFAMD(snorena); # slow method to estimate number of components\nfamd.imp <- missMDA::imputeFAMD(snorena, ncp = 3)$completeObs\n```\n:::\n\n\n\n\n\n# Multiple imputation\n\n* As mentioned in the intro, multiple imputation is the gold standard for handling missing data because it accounts for uncertainty in the imputed values.\n* Impute dataset multiple times to create *multiple imputed datasets*.  Analyze each dataset separately then pool the results for statistical inference.\n* [Multiple imputation by chained equations: what is it and how does it work?](https://onlinelibrary.wiley.com/doi/abs/10.1002/mpr.329)\n* [mice R package](https://cran.r-project.org/web/packages/mice/index.html)\n    * [mice JSS article](https://www.jstatsoft.org/article/view/v045i03)\n\n\n:::{.callout-note collapse=\"true\"}\n## Expand for Session Info\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 10 x64 (build 19045)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: America/Los_Angeles\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n[1] impute_1.80.0  missMDA_1.19   missForest_1.5\n\nloaded via a namespace (and not attached):\n [1] shape_1.4.6.1        gtable_0.3.5         xfun_0.49           \n [4] ggplot2_3.5.1        htmlwidgets_1.6.4    ggrepel_0.9.6       \n [7] lattice_0.22-6       vctrs_0.6.5          tools_4.4.1         \n[10] generics_0.1.3       parallel_4.4.1       sandwich_3.1-1      \n[13] tibble_3.2.1         fansi_1.0.6          pan_1.9             \n[16] cluster_2.1.6        jomo_2.7-6           pkgconfig_2.0.3     \n[19] Matrix_1.7-0         rngtools_1.5.2       scatterplot3d_0.3-44\n[22] lifecycle_1.0.4      compiler_4.4.1       munsell_0.5.1       \n[25] leaps_3.2            codetools_0.2-20     htmltools_0.5.8.1   \n[28] glmnet_4.1-8         yaml_2.3.10          mice_3.17.0         \n[31] nloptr_2.1.1         pillar_1.9.0         FactoMineR_2.11     \n[34] tidyr_1.3.1          MASS_7.3-60.2        flashClust_1.01-2   \n[37] DT_0.33              doRNG_1.8.6          iterators_1.0.14    \n[40] rpart_4.1.23         boot_1.3-30          mitml_0.4-5         \n[43] multcomp_1.4-26      foreach_1.5.2        nlme_3.1-164        \n[46] tidyselect_1.2.1     digest_0.6.37        mvtnorm_1.3-1       \n[49] dplyr_1.1.4          purrr_1.0.2          splines_4.4.1       \n[52] fastmap_1.2.0        grid_4.4.1           colorspace_2.1-1    \n[55] cli_3.6.3            magrittr_2.0.3       randomForest_4.7-1.2\n[58] survival_3.6-4       utf8_1.2.4           broom_1.0.7         \n[61] TH.data_1.1-2        scales_1.3.0         backports_1.5.0     \n[64] estimability_1.5.1   rmarkdown_2.28       emmeans_1.10.6      \n[67] nnet_7.3-19          lme4_1.1-35.5        zoo_1.8-12          \n[70] coda_0.19-4.1        evaluate_1.0.0       knitr_1.48          \n[73] doParallel_1.0.17    rlang_1.1.4          itertools_0.1-3     \n[76] Rcpp_1.0.13          xtable_1.8-4         glue_1.8.0          \n[79] minqa_1.2.8          rstudioapi_0.16.0    jsonlite_1.8.9      \n[82] R6_2.5.1             multcompView_0.1-10 \n```\n\n\n:::\n:::\n\n\n\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}